---
import { type CollectionEntry, getCollection } from "astro:content";
import PostsListLayout from "@/layouts/PostsListLayout.astro";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  const tags = new Map<string, CollectionEntry<"blog">[]>();

  for (const post of posts) {
    for (const tag of post.data.tags || []) {
      if (!tags.has(tag)) {
        tags.set(tag, []);
      }
      tags.get(tag)!.push(post);
    }
  }

  return Array.from(tags.entries()).map(([tag, posts]) => ({
    params: { tag },
    props: { tag, posts },
  }));
}

type Props = {
  tag: string;
  posts: CollectionEntry<"blog">[];
};

const { tag, posts } = Astro.props;
---

<PostsListLayout
  title={`Tag ⬝ ${tag}`}
  description={`Posts tagged with ${tag}`}
  posts={posts}
>
  <span slot="title">
    <div class="inline-block">
      <div class="i-mingcute-tag-fill"></div>
    </div>
    {tag}
  </span>
</PostsListLayout>
